Claro! Aqui est√° o **Dockerfile completo** que instala e configura:

- **Postfix (SMTP)**
- **Dovecot (IMAP)**
- **Roundcube (Webmail)**
- **Apache2 + PHP**
- **Supervisor** para gerenciar os servi√ßos

```Dockerfile
FROM debian:bullseye

ENV DEBIAN_FRONTEND=noninteractive

# Atualiza e instala os pacotes necess√°rios
RUN apt-get update && apt-get install -y \
    postfix \
    dovecot-core dovecot-imapd \
    apache2 \
    php php-mbstring php-intl php-common php-curl php-zip php-mysql php-xml php-cli php-gd \
    roundcube roundcube-core roundcube-mysql roundcube-plugins \
    supervisor \
    wget \
    nano \
    net-tools \
    iputils-ping \
    && apt-get clean

# Configura o Apache para servir o Roundcube
RUN echo "Alias /webmail /var/lib/roundcube" > /etc/apache2/conf-available/roundcube.conf \
    && echo "<Directory /var/lib/roundcube>" >> /etc/apache2/conf-available/roundcube.conf \
    && echo "    Options +FollowSymLinks" >> /etc/apache2/conf-available/roundcube.conf \
    && echo "    AllowOverride All" >> /etc/apache2/conf-available/roundcube.conf \
    && echo "    Require all granted" >> /etc/apache2/conf-available/roundcube.conf \
    && echo "</Directory>" >> /etc/apache2/conf-available/roundcube.conf \
    && a2enconf roundcube

# Ativa m√≥dulos do Apache
RUN a2enmod rewrite

# Cria diret√≥rio de configura√ß√£o do Supervisor
RUN mkdir -p /etc/supervisor/conf.d

# Copie o arquivo supervisord.conf para esse caminho no build:
# COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf

# Exp√µe as portas necess√°rias
EXPOSE 25 587 993 80

# Inicia todos os servi√ßos com o Supervisor
CMD ["/usr/bin/supervisord", "-n", "-c", "/etc/supervisor/conf.d/supervisord.conf"]
```

---

### ‚úÖ O que voc√™ precisa fazer agora:

1. Criar o arquivo `supervisord.conf` com os comandos para iniciar Postfix, Dovecot e Apache.
2. Criar os arquivos de configura√ß√£o do Postfix e Dovecot (se ainda n√£o tiver).
3. Criar o `docker-compose.yml` para orquestrar o container.

Se quiser, posso te mandar o conte√∫do do `supervisord.conf` e os arquivos de configura√ß√£o agora mesmo. Deseja isso?

## üì¶ Estrutura do Container `mail`

## üìß 1. Postfix (SMTP)

### Arquivo: `mail/config/postfix/main.cf`

```ini
myhostname = mail.local
mydomain = local
myorigin = /etc/mailname
inet_interfaces = all
inet_protocols = ipv4
mydestination = $myhostname, localhost.$mydomain, localhost
relayhost =
mynetworks = 127.0.0.0/8
home_mailbox = Maildir/
smtpd_banner = $myhostname ESMTP
```

Esse arquivo define:
- O nome do host do servidor de e-mail
- Que ele aceita conex√µes locais
- Que os e-mails ser√£o armazenados no formato **Maildir**

---

## üì• 2. Dovecot (IMAP)

### Arquivo: `mail/config/dovecot/dovecot.conf`

```conf
disable_plaintext_auth = no
mail_privileged_group = mail
protocols = imap
!include conf.d/*.conf
```

### Arquivo: `mail/config/dovecot/10-mail.conf`

```conf
mail_location = maildir:~/Maildir
```

### Arquivo: `mail/config/dovecot/10-auth.conf`

```conf
disable_plaintext_auth = no
auth_mechanisms = plain login
!include auth-system.conf.ext
```

Esses arquivos configuram o Dovecot para:
- Usar autentica√ß√£o simples (√∫til para testes locais)
- Acessar os e-mails no formato Maildir
- Usar autentica√ß√£o do sistema (usu√°rios do container)

---

## üåê 3. Roundcube (Webmail)

### Arquivo: `mail/config/roundcube/apache.conf`

```apache
Alias /webmail /var/lib/roundcube

<Directory /var/lib/roundcube>
    Options +FollowSymLinks
    AllowOverride All
    Require all granted
</Directory>
```

Esse arquivo configura o Apache para servir o Roundcube em `http://localhost:8080/webmail`.

---

## üß© 4. Supervisor

### Arquivo: `mail/config/supervisord.conf`

```ini
[supervisord]
nodaemon=true

[program:postfix]
command=/usr/sbin/postfix start-fg

[program:dovecot]
command=/usr/sbin/dovecot -F

[program:apache2]
command=/usr/sbin/apache2ctl -D FOREGROUND
```

Esse arquivo garante que todos os servi√ßos iniciem juntos no container.

---

## üê≥ 5. docker-compose.yml

```yaml
version: '3.8'

services:
  mail:
    build: ./mail
    container_name: mailserver
    ports:
      - "25:25"
      - "587:587"
      - "993:993"
      - "8080:80"
    volumes:
      - maildata:/var/mail
    restart: unless-stopped

volumes:
  maildata:
```

---

## ‚úÖ Pr√≥ximos passos

Voc√™ pode:
1. Criar usu√°rios de e-mail no container com `adduser`
2. Testar envio/recebimento com um cliente de e-mail ou o Roundcube
3. Adicionar suporte a SSL (STARTTLS ou IMAPS)

---

Se quiser, posso gerar um novo `.zip` com todos esses arquivos atualizados para voc√™ baixar e usar direto no VS Code. Deseja isso?
